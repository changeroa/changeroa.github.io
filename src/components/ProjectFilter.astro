---
interface Props {
  tags: string[];
  allLabel?: string;
}

const { tags, allLabel = 'All' } = Astro.props;

const uniqueTags = [...new Set(tags)].sort();
---

<div class="project-filter">
  <button 
    class="filter-btn active" 
    data-filter="all"
    data-cursor-hover
  >
    {allLabel}
  </button>
  {uniqueTags.map((tag) => (
    <button 
      class="filter-btn" 
      data-filter={tag.toLowerCase().replace(/\s+/g, '-')}
      data-cursor-hover
    >
      {tag}
    </button>
  ))}
</div>

<style>
  .project-filter {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    justify-content: center;
    margin-bottom: 3rem;
  }

  .filter-btn {
    padding: 0.5rem 1.25rem;
    border: 1px solid var(--color-text-muted);
    border-radius: 100px;
    background: transparent;
    color: var(--color-text-muted);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.25s ease;
    white-space: nowrap;
  }

  .filter-btn:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
  }

  .filter-btn:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  .filter-btn.active {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
  }

  @media (max-width: 600px) {
    .project-filter {
      gap: 0.5rem;
    }

    .filter-btn {
      padding: 0.4rem 1rem;
      font-size: 0.8rem;
    }
  }
</style>

<script>
  function initProjectFilter() {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const filterableItems = document.querySelectorAll('[data-tags]');

    filterBtns.forEach((btn) => {
      btn.addEventListener('click', () => {
        // Update active state
        filterBtns.forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');

        const filter = (btn as HTMLElement).dataset.filter;

        filterableItems.forEach((item) => {
          const el = item as HTMLElement;
          const tags = el.dataset.tags?.toLowerCase().split(',').map((t) => t.trim().replace(/\s+/g, '-')) || [];

          if (filter === 'all' || tags.includes(filter || '')) {
            el.style.display = '';
            el.classList.remove('hidden');
            // Trigger re-animation if using scroll reveal
            setTimeout(() => {
              el.style.opacity = '1';
              el.style.transform = 'none';
            }, 50);
          } else {
            el.style.display = 'none';
            el.classList.add('hidden');
          }
        });
      });
    });
  }

  initProjectFilter();
  document.addEventListener('astro:page-load', initProjectFilter);
</script>

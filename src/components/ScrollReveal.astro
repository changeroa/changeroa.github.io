---
interface Props {
  animation?: 'fade-up' | 'fade-down' | 'fade-left' | 'fade-right' | 'zoom-in' | 'zoom-out';
  delay?: number; // ms
  duration?: number; // ms
  threshold?: number; // 0-1
  once?: boolean;
  class?: string;
}

const {
  animation = 'fade-up',
  delay = 0,
  duration = 600,
  threshold = 0.1,
  once = true,
  class: className = '',
} = Astro.props;
---

<div 
  class={`scroll-reveal ${animation} ${className}`}
  data-delay={delay}
  data-duration={duration}
  data-threshold={threshold}
  data-once={once}
>
  <slot />
</div>

<style>
  .scroll-reveal {
    opacity: 0;
    transition-property: opacity, transform;
    transition-timing-function: cubic-bezier(0.25, 1, 0.5, 1);
  }

  /* Fade Up */
  .scroll-reveal.fade-up {
    transform: translateY(40px);
  }
  .scroll-reveal.fade-up.revealed {
    opacity: 1;
    transform: translateY(0);
  }

  /* Fade Down */
  .scroll-reveal.fade-down {
    transform: translateY(-40px);
  }
  .scroll-reveal.fade-down.revealed {
    opacity: 1;
    transform: translateY(0);
  }

  /* Fade Left */
  .scroll-reveal.fade-left {
    transform: translateX(40px);
  }
  .scroll-reveal.fade-left.revealed {
    opacity: 1;
    transform: translateX(0);
  }

  /* Fade Right */
  .scroll-reveal.fade-right {
    transform: translateX(-40px);
  }
  .scroll-reveal.fade-right.revealed {
    opacity: 1;
    transform: translateX(0);
  }

  /* Zoom In */
  .scroll-reveal.zoom-in {
    transform: scale(0.9);
  }
  .scroll-reveal.zoom-in.revealed {
    opacity: 1;
    transform: scale(1);
  }

  /* Zoom Out */
  .scroll-reveal.zoom-out {
    transform: scale(1.1);
  }
  .scroll-reveal.zoom-out.revealed {
    opacity: 1;
    transform: scale(1);
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .scroll-reveal {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }
</style>

<script>
  function initScrollReveal() {
    const elements = document.querySelectorAll('.scroll-reveal:not(.revealed)');
    
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const el = entry.target as HTMLElement;
            const delay = parseInt(el.dataset.delay || '0', 10);
            const duration = parseInt(el.dataset.duration || '600', 10);
            const once = el.dataset.once !== 'false';

            el.style.transitionDuration = `${duration}ms`;
            el.style.transitionDelay = `${delay}ms`;

            setTimeout(() => {
              el.classList.add('revealed');
            }, 10);

            if (once) {
              observer.unobserve(el);
            }
          } else {
            const el = entry.target as HTMLElement;
            const once = el.dataset.once !== 'false';
            if (!once) {
              el.classList.remove('revealed');
            }
          }
        });
      },
      {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px',
      }
    );

    elements.forEach((el) => {
      const threshold = parseFloat((el as HTMLElement).dataset.threshold || '0.1');
      observer.observe(el);
    });
  }

  // Check for reduced motion preference
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  
  if (!prefersReducedMotion) {
    initScrollReveal();
    document.addEventListener('astro:page-load', initScrollReveal);
  } else {
    // If reduced motion, just show all elements
    document.querySelectorAll('.scroll-reveal').forEach((el) => {
      el.classList.add('revealed');
    });
  }
</script>

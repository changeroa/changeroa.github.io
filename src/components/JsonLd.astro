---
import type { Lang } from '../i18n/translations';

interface Props {
  type: 'Person' | 'WebSite' | 'Article' | 'BreadcrumbList';
  lang?: Lang;
  // Person props
  name?: string;
  jobTitle?: string;
  email?: string;
  url?: string;
  sameAs?: string[];
  // Article props
  headline?: string;
  description?: string;
  image?: string;
  datePublished?: string;
  dateModified?: string;
  author?: string;
  // Breadcrumb props
  breadcrumbs?: Array<{ name: string; url: string }>;
}

const {
  type,
  lang = 'ko',
  name = 'Victor Jaepyo Jo',
  jobTitle = 'Full-stack Developer',
  email,
  url = 'https://changeroa.github.io',
  sameAs = [],
  headline,
  description,
  image,
  datePublished,
  dateModified,
  author,
  breadcrumbs = [],
} = Astro.props;

const generatePersonSchema = () => ({
  '@context': 'https://schema.org',
  '@type': 'Person',
  name,
  jobTitle,
  url,
  ...(email && { email: `mailto:${email}` }),
  ...(sameAs.length > 0 && { sameAs }),
});

const generateWebSiteSchema = () => ({
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: `${name} - Portfolio`,
  url,
  inLanguage: lang === 'ko' ? 'ko-KR' : 'en-US',
  author: {
    '@type': 'Person',
    name,
  },
});

const generateArticleSchema = () => ({
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline,
  description,
  ...(image && { image }),
  ...(datePublished && { datePublished }),
  ...(dateModified && { dateModified }),
  author: {
    '@type': 'Person',
    name: author || name,
  },
  publisher: {
    '@type': 'Person',
    name,
  },
});

const generateBreadcrumbSchema = () => ({
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: breadcrumbs.map((item, index) => ({
    '@type': 'ListItem',
    position: index + 1,
    name: item.name,
    item: item.url,
  })),
});

const getSchema = () => {
  switch (type) {
    case 'Person':
      return generatePersonSchema();
    case 'WebSite':
      return generateWebSiteSchema();
    case 'Article':
      return generateArticleSchema();
    case 'BreadcrumbList':
      return generateBreadcrumbSchema();
    default:
      return null;
  }
};

const schema = getSchema();
---

{schema && (
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />
)}
